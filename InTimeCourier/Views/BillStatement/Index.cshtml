@model InTimeCourier.Models.BillDetails
@{
    ViewBag.Title = "Statement";
}
<link href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.dataTables.min.css" rel="stylesheet" />

<div class="container">
    <h4>Statement</h4>
    <hr />
    <div style="background-color:#f5f5f5; padding:20px">
        <table id="tblFilter">
            <tbody>
                <tr>
                    <td>
                        @Html.DropDownListFor(model => model.PartyId, (IEnumerable<SelectListItem>)ViewBag.Party,
                       "Select Party", new { @class = "form-control" })
                    </td>
                    <td><input type="text" placeholder="From Date" class="form-control" readonly id="txtFromDate" /></td>
                    <td><input type="text" placeholder="To Date" class="form-control" readonly id="txtToDate" /></td>
                    <td>
                        <input type="button" class="btn btn-success btn-md" value="Filter" id="btnFilter" />
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    @*<div style="width:90%; margin:0 auto;">*@
    <table id="statementTable" class="table table-responsive table-striped">
        <thead>
            <tr class="alert alert-warning">
                <th style="white-space:nowrap">Bill No</th>
                <th style="white-space:nowrap">Party Name</th>
                <th style="white-space:nowrap">GSTIN Number</th>
                <th style="white-space:nowrap">Bill Date</th>
                <th style="white-space:nowrap">From</th>
                <th style="white-space:nowrap">To</th>
                <th style="white-space:nowrap">Amount</th>
                <th style="white-space:nowrap">Fuel Charges</th>
                <th style="white-space:nowrap">CGST(9%)</th>
                <th style="white-space:nowrap">SGST(9%)</th>
                <th style="white-space:nowrap">Grand Total</th>
                <th style="white-space:nowrap">Paid</th>
                <th style="white-space:nowrap">Cheque No</th>
            </tr>
        </thead>
    </table>
    @*</div>*@
    @section Scripts {
        <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
        <script src="//cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
        <script src="//cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
        <script src="//cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"></script>
        <script src="//cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"></script>
        <script>
            $(document).ready(function () {
                var buttonCommon = {
                    exportOptions: {
                        format: {
                            body: function (data, row, column, node) {
                                // Strip $ from salary column to make it numeric
                                return column === 5 ?
                                    data.replace(/[$,]/g, '') :
                                    data;
                            }
                        }
                    }
                };
                //jQuery DataTables initialization
                $('#statementTable').DataTable({
                    "language":
                    {
                        "processing": "<div class='overlay custom-loader-background'>" +
                            "<i class= 'fa fa-cog fa-spin custom-loader-color'></i></div>"
                    },
                    "processing": true,
                    "serverSide": true,
                    "orderMulti": false,
                    "dom": '<"top"i>rt<"bottom"lp><"clear">',
                    "ajax": {
                        "url": "/BillStatement/SearchStatement",
                        "type": "POST",
                        "datatype": "json"
                    },
                    lengthMenu: [[20, 100, -1], [20, 100, "All"]],
                    pageLength: 20,
                    "columns": [
                        { "data": "BillNo", "name": "BillNo", "autoWidth": true },
                        { "data": "PartyName", "name": "PartyName", "autoWidth": true },
                        { "data": "GSTINNumber", "name": "GSTINNumber", "autoWidth": true },
                        { "data": "BillDate", "name": "BillDate", "autoWidth": true },
                        { "data": "PeriodFrom", "name": "PeriodFrom", "autoWidth": true },
                        { "data": "PeriodTo", "name": "PeriodTo", "autoWidth": true },
                        { "data": "TotalAmount", "name": "TotalAmount", "autoWidth": true },
                        { "data": "FullCharges", "name": "FullCharges", "autoWidth": true },
                        { "data": "CGST", "name": "CGST", "autoWidth": true },
                        { "data": "SGST", "name": "SGST", "autoWidth": true },
                        { "data": "GrandTotal", "name": "GrandTotal", "autoWidth": true },
                        { "data": "PaidAmount", "name": "PaidAmount", "autoWidth": true },
                        { "data": "ChequeNo", "name": "ChequeNo", "autoWidth": true }
                    ],
                    dom: 'Bfrtip',
                    buttons: [
                        {
                            title: ' ',
                            extend: 'print',
                            customize: function (win) {
                                $(win.document.body)
                                    .css('font-size', '10pt')
                                    .prepend(
                                        `<table class="table table-bordered" style="width:100%;">
                                                <tr>
                                                    <td colspan="2">
                                                        <center>
                                                            <h1>In Time  Logistics</h1>
                                                            <h4>Kaman Road, Chinchoti Road, Vasai(East), Palghar-401208.</h4>
                                                            <h4>Tel :+919320030626/+919028826303 </h4>
                                                            <h4>Email Id: intimelogistic119@gmail.com</h4>
                                                        </center>
                                                    </td>
                                                </tr>
                                            </table>
                                        `
                                    );

                                $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                            }
                        },
                    ]
                });

                oTable = $('#statementTable').DataTable();
                $('#btnFilter').click(function () {
                    oTable.columns(4).search($('#PartyId').val().trim());
                    oTable.columns(5).search($('#txtFromDate').val().trim());
                    oTable.columns(6).search($('#txtToDate').val().trim());
                    oTable.draw();
                });
            });

            $(function () {
                $("#txtFromDate").datepicker({
                    changeMonth: true,
                    changeYear: true
                });

                $("#txtToDate").datepicker({
                    changeMonth: true,
                    changeYear: true
                });

            });
        </script>
    }

</div>